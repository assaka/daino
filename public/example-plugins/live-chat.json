{
  "packageVersion": "1.0.0",
  "exportedAt": "2026-01-01T12:00:00.000Z",
  "plugin": {
    "name": "Live Chat",
    "slug": "live-chat",
    "version": "1.0.0",
    "description": "Simple live chat widget for customer support with admin dashboard",
    "author": "DainoStore",
    "category": "support",
    "type": "utility",
    "framework": "react",
    "manifest": {
      "name": "Live Chat",
      "tags": [
        "chat",
        "support",
        "customer-service",
        "widget",
        "messaging"
      ],
      "author": "DainoStore",
      "version": "1.0.0",
      "category": "support",
      "description": "Provide real-time customer support through a chat widget",
      "permissions": [
        "customers:read"
      ],
      "adminNavigation": {
        "enabled": true,
        "label": "Live Chat",
        "icon": "MessageCircle",
        "route": "/admin/plugins/live-chat",
        "order": 100
      }
    },
    "permissions": [
      "customers:read"
    ],
    "dependencies": [],
    "tags": [
      "chat",
      "support",
      "messaging"
    ]
  },
  "files": [],
  "events": [],
  "hooks": [],
  "widgets": [
    {
      "widgetId": "chat-widget",
      "widgetName": "Chat Widget",
      "description": "Floating chat button and conversation window",
      "componentCode": "function ChatWidget({ config = {} }) {\n  const [open, setOpen] = React.useState(false);\n  const [messages, setMessages] = React.useState([]);\n  const [input, setInput] = React.useState('');\n  const [sessionId, setSessionId] = React.useState(null);\n  const [unread, setUnread] = React.useState(0);\n  const messagesEndRef = React.useRef(null);\n\n  const {\n    primaryColor = '#3b82f6',\n    welcomeMessage = 'Hi! How can we help you today?',\n    agentName = 'Support',\n    position = 'right'\n  } = config;\n\n  React.useEffect(() => {\n    // Get or create session\n    let sid = sessionStorage.getItem('chat-session-id');\n    if (!sid) {\n      sid = 'chat-' + Math.random().toString(36).substr(2, 9);\n      sessionStorage.setItem('chat-session-id', sid);\n    }\n    setSessionId(sid);\n\n    // Add welcome message\n    setMessages([{\n      id: 1,\n      from: 'agent',\n      text: welcomeMessage,\n      time: new Date().toISOString()\n    }]);\n\n    // Poll for new messages\n    const pollInterval = setInterval(async () => {\n      if (!open) {\n        try {\n          const response = await fetch(`/api/plugins/live-chat/exec/messages?session_id=${sid}&unread=true`);\n          const result = await response.json();\n          if (result.success && result.unreadCount > 0) {\n            setUnread(result.unreadCount);\n          }\n        } catch (e) {}\n      }\n    }, 5000);\n\n    return () => clearInterval(pollInterval);\n  }, [welcomeMessage, open]);\n\n  React.useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [messages]);\n\n  const handleSend = async () => {\n    if (!input.trim()) return;\n\n    const newMessage = {\n      id: Date.now(),\n      from: 'customer',\n      text: input,\n      time: new Date().toISOString()\n    };\n\n    setMessages(prev => [...prev, newMessage]);\n    setInput('');\n\n    try {\n      await fetch('/api/plugins/live-chat/exec/messages', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          session_id: sessionId,\n          message: input,\n          from: 'customer'\n        })\n      });\n    } catch (error) {\n      console.error('Failed to send message:', error);\n    }\n  };\n\n  const handleOpen = async () => {\n    setOpen(true);\n    setUnread(0);\n\n    // Load message history\n    try {\n      const response = await fetch(`/api/plugins/live-chat/exec/messages?session_id=${sessionId}`);\n      const result = await response.json();\n      if (result.success && result.messages.length > 0) {\n        setMessages(result.messages);\n      }\n    } catch (e) {}\n  };\n\n  const positionStyles = position === 'left'\n    ? { left: '20px' }\n    : { right: '20px' };\n\n  return React.createElement(React.Fragment, null,\n    // Chat Button\n    !open && React.createElement('button', {\n      onClick: handleOpen,\n      style: {\n        position: 'fixed',\n        bottom: '20px',\n        ...positionStyles,\n        width: '60px',\n        height: '60px',\n        borderRadius: '50%',\n        background: primaryColor,\n        border: 'none',\n        cursor: 'pointer',\n        boxShadow: '0 4px 12px rgba(0,0,0,0.15)',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        zIndex: 1000\n      }\n    },\n      React.createElement('span', { style: { fontSize: '28px' } }, 'ðŸ’¬'),\n      unread > 0 && React.createElement('span', {\n        style: {\n          position: 'absolute',\n          top: '-5px',\n          right: '-5px',\n          background: '#ef4444',\n          color: 'white',\n          borderRadius: '50%',\n          width: '24px',\n          height: '24px',\n          fontSize: '12px',\n          fontWeight: 'bold',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center'\n        }\n      }, unread)\n    ),\n\n    // Chat Window\n    open && React.createElement('div', {\n      style: {\n        position: 'fixed',\n        bottom: '20px',\n        ...positionStyles,\n        width: '350px',\n        height: '500px',\n        background: 'white',\n        borderRadius: '12px',\n        boxShadow: '0 8px 30px rgba(0,0,0,0.12)',\n        display: 'flex',\n        flexDirection: 'column',\n        overflow: 'hidden',\n        zIndex: 1000\n      }\n    },\n      // Header\n      React.createElement('div', {\n        style: {\n          background: primaryColor,\n          color: 'white',\n          padding: '16px',\n          display: 'flex',\n          justifyContent: 'space-between',\n          alignItems: 'center'\n        }\n      },\n        React.createElement('div', null,\n          React.createElement('div', { style: { fontWeight: '600' } }, agentName),\n          React.createElement('div', { style: { fontSize: '12px', opacity: 0.9 } }, 'Online')\n        ),\n        React.createElement('button', {\n          onClick: () => setOpen(false),\n          style: {\n            background: 'none',\n            border: 'none',\n            color: 'white',\n            fontSize: '24px',\n            cursor: 'pointer'\n          }\n        }, 'Ã—')\n      ),\n\n      // Messages\n      React.createElement('div', {\n        style: {\n          flex: 1,\n          overflowY: 'auto',\n          padding: '16px',\n          display: 'flex',\n          flexDirection: 'column',\n          gap: '12px'\n        }\n      },\n        messages.map(msg =>\n          React.createElement('div', {\n            key: msg.id,\n            style: {\n              alignSelf: msg.from === 'customer' ? 'flex-end' : 'flex-start',\n              maxWidth: '80%'\n            }\n          },\n            React.createElement('div', {\n              style: {\n                background: msg.from === 'customer' ? primaryColor : '#f3f4f6',\n                color: msg.from === 'customer' ? 'white' : '#374151',\n                padding: '10px 14px',\n                borderRadius: msg.from === 'customer' ? '16px 16px 4px 16px' : '16px 16px 16px 4px',\n                fontSize: '14px'\n              }\n            }, msg.text),\n            React.createElement('div', {\n              style: {\n                fontSize: '10px',\n                color: '#9ca3af',\n                marginTop: '4px',\n                textAlign: msg.from === 'customer' ? 'right' : 'left'\n              }\n            }, new Date(msg.time).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }))\n          )\n        ),\n        React.createElement('div', { ref: messagesEndRef })\n      ),\n\n      // Input\n      React.createElement('div', {\n        style: {\n          padding: '12px',\n          borderTop: '1px solid #e5e7eb',\n          display: 'flex',\n          gap: '8px'\n        }\n      },\n        React.createElement('input', {\n          type: 'text',\n          value: input,\n          onChange: (e) => setInput(e.target.value),\n          onKeyPress: (e) => e.key === 'Enter' && handleSend(),\n          placeholder: 'Type a message...',\n          style: {\n            flex: 1,\n            padding: '10px 14px',\n            border: '1px solid #e5e7eb',\n            borderRadius: '20px',\n            fontSize: '14px',\n            outline: 'none'\n          }\n        }),\n        React.createElement('button', {\n          onClick: handleSend,\n          style: {\n            background: primaryColor,\n            color: 'white',\n            border: 'none',\n            borderRadius: '50%',\n            width: '40px',\n            height: '40px',\n            cursor: 'pointer',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center'\n          }\n        }, 'âž¤')\n      )\n    )\n  );\n}",
      "defaultConfig": {
        "primaryColor": "#3b82f6",
        "welcomeMessage": "Hi! How can we help you today?",
        "agentName": "Support",
        "position": "right"
      },
      "category": "support",
      "icon": "MessageCircle"
    }
  ],
  "entities": [
    {
      "name": "ChatSession",
      "tableName": "chat_sessions",
      "schemaDefinition": {
        "columns": [
          {
            "name": "id",
            "type": "UUID",
            "default": "gen_random_uuid()",
            "primaryKey": true
          },
          {
            "name": "session_id",
            "type": "VARCHAR(100)",
            "notNull": true
          },
          {
            "name": "customer_id",
            "type": "UUID",
            "nullable": true
          },
          {
            "name": "customer_email",
            "type": "VARCHAR(255)",
            "nullable": true
          },
          {
            "name": "status",
            "type": "VARCHAR(20)",
            "default": "'active'"
          },
          {
            "name": "created_at",
            "type": "TIMESTAMP WITH TIME ZONE",
            "default": "NOW()"
          },
          {
            "name": "updated_at",
            "type": "TIMESTAMP WITH TIME ZONE",
            "default": "NOW()"
          }
        ],
        "indexes": [
          {
            "name": "idx_chat_sessions_session_id",
            "columns": [
              "session_id"
            ],
            "unique": true
          },
          {
            "name": "idx_chat_sessions_status",
            "columns": [
              "status"
            ]
          }
        ],
        "foreignKeys": []
      },
      "description": "Chat session records"
    },
    {
      "name": "ChatMessage",
      "tableName": "chat_messages",
      "schemaDefinition": {
        "columns": [
          {
            "name": "id",
            "type": "UUID",
            "default": "gen_random_uuid()",
            "primaryKey": true
          },
          {
            "name": "session_id",
            "type": "VARCHAR(100)",
            "notNull": true
          },
          {
            "name": "from_type",
            "type": "VARCHAR(20)",
            "notNull": true
          },
          {
            "name": "message",
            "type": "TEXT",
            "notNull": true
          },
          {
            "name": "read_at",
            "type": "TIMESTAMP WITH TIME ZONE",
            "nullable": true
          },
          {
            "name": "created_at",
            "type": "TIMESTAMP WITH TIME ZONE",
            "default": "NOW()"
          }
        ],
        "indexes": [
          {
            "name": "idx_chat_messages_session",
            "columns": [
              "session_id"
            ]
          },
          {
            "name": "idx_chat_messages_created",
            "columns": [
              "created_at"
            ],
            "order": "DESC"
          }
        ],
        "foreignKeys": []
      },
      "description": "Chat messages"
    }
  ],
  "migrations": [
    {
      "name": "create_chat_tables",
      "pluginName": "Live Chat",
      "migrationVersion": "1704067200000_create_chat_tables",
      "code": "CREATE TABLE IF NOT EXISTS chat_sessions (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  session_id VARCHAR(100) NOT NULL UNIQUE,\n  customer_id UUID,\n  customer_email VARCHAR(255),\n  status VARCHAR(20) DEFAULT 'active',\n  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\nCREATE INDEX IF NOT EXISTS idx_chat_sessions_status ON chat_sessions(status);\n\nCREATE TABLE IF NOT EXISTS chat_messages (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  session_id VARCHAR(100) NOT NULL,\n  from_type VARCHAR(20) NOT NULL,\n  message TEXT NOT NULL,\n  read_at TIMESTAMP WITH TIME ZONE,\n  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\nCREATE INDEX IF NOT EXISTS idx_chat_messages_session ON chat_messages(session_id);\nCREATE INDEX IF NOT EXISTS idx_chat_messages_created ON chat_messages(created_at DESC);\n"
    }
  ],
  "controllers": [
    {
      "name": "getMessages",
      "method": "GET",
      "path": "/messages",
      "code": "async function getMessages(req, res, { sequelize }) {\n  const { session_id, unread } = req.query;\n\n  if (!session_id) {\n    return res.status(400).json({ success: false, error: 'Session ID required' });\n  }\n\n  try {\n    if (unread === 'true') {\n      const result = await sequelize.query(`\n        SELECT COUNT(*) as count FROM chat_messages\n        WHERE session_id = $1 AND from_type = 'agent' AND read_at IS NULL\n      `, {\n        bind: [session_id],\n        type: sequelize.QueryTypes.SELECT\n      });\n      return res.json({ success: true, unreadCount: parseInt(result[0].count) });\n    }\n\n    const messages = await sequelize.query(`\n      SELECT id, from_type as \"from\", message as text, created_at as time\n      FROM chat_messages\n      WHERE session_id = $1\n      ORDER BY created_at ASC\n    `, {\n      bind: [session_id],\n      type: sequelize.QueryTypes.SELECT\n    });\n\n    // Mark as read\n    await sequelize.query(`\n      UPDATE chat_messages SET read_at = NOW()\n      WHERE session_id = $1 AND from_type = 'agent' AND read_at IS NULL\n    `, {\n      bind: [session_id],\n      type: sequelize.QueryTypes.UPDATE\n    });\n\n    return res.json({ success: true, messages });\n  } catch (error) {\n    return res.status(500).json({ success: false, error: error.message });\n  }\n}",
      "description": "Get chat messages for a session"
    },
    {
      "name": "sendMessage",
      "method": "POST",
      "path": "/messages",
      "code": "async function sendMessage(req, res, { sequelize }) {\n  const { session_id, message, from } = req.body;\n\n  if (!session_id || !message) {\n    return res.status(400).json({ success: false, error: 'Session ID and message required' });\n  }\n\n  try {\n    // Ensure session exists\n    await sequelize.query(`\n      INSERT INTO chat_sessions (session_id, status)\n      VALUES ($1, 'active')\n      ON CONFLICT (session_id) DO UPDATE SET updated_at = NOW()\n    `, {\n      bind: [session_id],\n      type: sequelize.QueryTypes.INSERT\n    });\n\n    // Insert message\n    const result = await sequelize.query(`\n      INSERT INTO chat_messages (session_id, from_type, message)\n      VALUES ($1, $2, $3)\n      RETURNING *\n    `, {\n      bind: [session_id, from || 'customer', message],\n      type: sequelize.QueryTypes.INSERT\n    });\n\n    return res.json({ success: true, message: result[0][0] });\n  } catch (error) {\n    return res.status(500).json({ success: false, error: error.message });\n  }\n}",
      "description": "Send a chat message"
    },
    {
      "name": "getActiveSessions",
      "method": "GET",
      "path": "/sessions",
      "code": "async function getActiveSessions(req, res, { sequelize }) {\n  try {\n    const sessions = await sequelize.query(`\n      SELECT \n        s.*,\n        (SELECT message FROM chat_messages WHERE session_id = s.session_id ORDER BY created_at DESC LIMIT 1) as last_message,\n        (SELECT COUNT(*) FROM chat_messages WHERE session_id = s.session_id AND from_type = 'customer' AND read_at IS NULL) as unread_count\n      FROM chat_sessions s\n      WHERE s.status = 'active'\n      ORDER BY s.updated_at DESC\n    `, {\n      type: sequelize.QueryTypes.SELECT\n    });\n\n    return res.json({ success: true, sessions });\n  } catch (error) {\n    return res.status(500).json({ success: false, error: error.message });\n  }\n}",
      "description": "Get active chat sessions for admin"
    },
    {
      "name": "replyToSession",
      "method": "POST",
      "path": "/sessions/:sessionId/reply",
      "code": "async function replyToSession(req, res, { sequelize }) {\n  const { sessionId } = req.params;\n  const { message } = req.body;\n\n  if (!message) {\n    return res.status(400).json({ success: false, error: 'Message required' });\n  }\n\n  try {\n    const result = await sequelize.query(`\n      INSERT INTO chat_messages (session_id, from_type, message)\n      VALUES ($1, 'agent', $2)\n      RETURNING *\n    `, {\n      bind: [sessionId, message],\n      type: sequelize.QueryTypes.INSERT\n    });\n\n    return res.json({ success: true, message: result[0][0] });\n  } catch (error) {\n    return res.status(500).json({ success: false, error: error.message });\n  }\n}",
      "description": "Send agent reply to a session"
    }
  ],
  "pluginData": [
    {
      "key": "config",
      "value": {
        "primaryColor": "#3b82f6",
        "welcomeMessage": "Hi! How can we help you today?",
        "agentName": "Support Team",
        "position": "right",
        "enabled": true
      }
    }
  ],
  "pluginDependencies": [],
  "pluginDocs": [
    {
      "title": "README",
      "content": "# Live Chat Plugin\n\nProvide real-time customer support through a chat widget.\n\n## Features\n\n- Floating chat button\n- Real-time messaging\n- Message persistence\n- Unread message badges\n- Admin reply interface\n- Session tracking\n\n## Customer View\n\n- Click chat bubble to open\n- Send messages\n- See agent replies\n- Unread notification\n\n## Admin API\n\n```\nGET /sessions - List active chats\nGET /messages?session_id=xxx - Get messages\nPOST /sessions/:id/reply - Send reply\n```\n\n## Customization\n\n- Primary color\n- Welcome message\n- Agent name\n- Position (left/right)\n",
      "category": "readme",
      "orderPosition": 0,
      "fileName": "README.md"
    }
  ],
  "adminPages": [
    {
      "pageKey": "chat-dashboard",
      "pageName": "Chat Dashboard",
      "route": "/admin/plugins/live-chat",
      "componentCode": "import React, { useState, useEffect } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport { MessageCircle, Send } from 'lucide-react';\n\nexport default function ChatDashboard() {\n  const [sessions, setSessions] = useState([]);\n  const [selectedSession, setSelectedSession] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [reply, setReply] = useState('');\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    loadSessions();\n    const interval = setInterval(loadSessions, 5000);\n    return () => clearInterval(interval);\n  }, []);\n\n  useEffect(() => {\n    if (selectedSession) {\n      loadMessages(selectedSession.session_id);\n    }\n  }, [selectedSession]);\n\n  const loadSessions = async () => {\n    try {\n      const response = await fetch('/api/plugins/live-chat/exec/sessions');\n      const data = await response.json();\n      if (data.success) {\n        setSessions(data.sessions);\n      }\n      setLoading(false);\n    } catch (error) {\n      console.error('Failed to load sessions:', error);\n      setLoading(false);\n    }\n  };\n\n  const loadMessages = async (sessionId) => {\n    try {\n      const response = await fetch(`/api/plugins/live-chat/exec/messages?session_id=${sessionId}`);\n      const data = await response.json();\n      if (data.success) {\n        setMessages(data.messages);\n      }\n    } catch (error) {\n      console.error('Failed to load messages:', error);\n    }\n  };\n\n  const handleSendReply = async () => {\n    if (!reply.trim() || !selectedSession) return;\n\n    try {\n      await fetch(`/api/plugins/live-chat/exec/sessions/${selectedSession.session_id}/reply`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ message: reply })\n      });\n      setReply('');\n      loadMessages(selectedSession.session_id);\n    } catch (error) {\n      console.error('Failed to send reply:', error);\n    }\n  };\n\n  return (\n    <div className=\"p-6\">\n      <div className=\"flex gap-6 h-[600px]\">\n        {/* Sessions List */}\n        <Card className=\"w-80 flex flex-col\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <MessageCircle className=\"w-5 h-5\" />\n              Active Chats\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"flex-1 overflow-y-auto\">\n            {loading ? (\n              <p className=\"text-gray-500\">Loading...</p>\n            ) : sessions.length === 0 ? (\n              <p className=\"text-gray-500\">No active chats</p>\n            ) : (\n              <div className=\"space-y-2\">\n                {sessions.map(session => (\n                  <div\n                    key={session.id}\n                    onClick={() => setSelectedSession(session)}\n                    className={`p-3 rounded-lg cursor-pointer border transition-colors ${\n                      selectedSession?.id === session.id\n                        ? 'border-blue-500 bg-blue-50'\n                        : 'border-gray-200 hover:bg-gray-50'\n                    }`}\n                  >\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"font-medium text-sm\">\n                        {session.session_id.substring(0, 12)}...\n                      </span>\n                      {session.unread_count > 0 && (\n                        <Badge className=\"bg-red-500\">{session.unread_count}</Badge>\n                      )}\n                    </div>\n                    <p className=\"text-xs text-gray-500 truncate mt-1\">\n                      {session.last_message || 'No messages'}\n                    </p>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Chat Window */}\n        <Card className=\"flex-1 flex flex-col\">\n          <CardHeader className=\"border-b\">\n            <CardTitle>\n              {selectedSession ? `Chat: ${selectedSession.session_id}` : 'Select a chat'}\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"flex-1 overflow-y-auto p-4\">\n            {selectedSession ? (\n              <div className=\"space-y-4\">\n                {messages.map(msg => (\n                  <div\n                    key={msg.id}\n                    className={`flex ${msg.from === 'agent' ? 'justify-end' : 'justify-start'}`}\n                  >\n                    <div\n                      className={`max-w-[70%] p-3 rounded-lg ${\n                        msg.from === 'agent'\n                          ? 'bg-blue-500 text-white'\n                          : 'bg-gray-100 text-gray-900'\n                      }`}\n                    >\n                      <p className=\"text-sm\">{msg.text}</p>\n                      <p className=\"text-xs opacity-70 mt-1\">\n                        {new Date(msg.time).toLocaleTimeString()}\n                      </p>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <div className=\"h-full flex items-center justify-center text-gray-500\">\n                Select a chat to view messages\n              </div>\n            )}\n          </CardContent>\n          {selectedSession && (\n            <div className=\"p-4 border-t flex gap-2\">\n              <Input\n                value={reply}\n                onChange={(e) => setReply(e.target.value)}\n                onKeyPress={(e) => e.key === 'Enter' && handleSendReply()}\n                placeholder=\"Type a reply...\"\n              />\n              <Button onClick={handleSendReply}>\n                <Send className=\"w-4 h-4\" />\n              </Button>\n            </div>\n          )}\n        </Card>\n      </div>\n    </div>\n  );\n}"
    }
  ]
}
